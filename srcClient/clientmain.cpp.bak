/* 
 * File:   main.cpp
 * Author: erupter
 *
 * Created on December 14, 2012, 4:54 PM
 */



//
// Hello World client in C++
// Connects REQ socket to tcp://localhost:5555
// Sends "Hello" to server, expects "World" back
//
#include <zmq.hpp>
#include <string>
#include <iostream>
#include <zhelpers.hpp>
//#include <zre.h>


//
// Pubsub envelope subscriber
//
// Olivier Chamoux <olivier.chamoux@fr.thalesgroup.com>


int main () {
    // Prepare our context and subscriber
    zmq::context_t context(1);
    zmq::socket_t subscriber (context, ZMQ_SUB);
    subscriber.connect("epgm://192.168.127.253;239.192.1.2:5678");
    //subscriber.connect("tcp://localhost:5678");
    subscriber.setsockopt( ZMQ_SUBSCRIBE, "B", 1);

    while (1) {

        // Read envelope with address
        std::string address = s_recv (subscriber);
        // Read message contents
        std::string contents = s_recv (subscriber);
        
        std::string termination = s_recv (subscriber);

        std::cout << "[" << address << "] " << contents << "  | Termination ["<< termination<<"]"<< std::endl;
    }
    return 0;
}


/*
int main ()
{
    // Prepare our context and socket
    zmq::context_t context (1);
    zmq::socket_t socket (context, ZMQ_REQ);

    std::cout << "Connecting to hello world server…" << std::endl;
    socket.connect ("tcp://localhost:5555");

    // Do 10 requests, waiting each time for a response
    for (int request_nbr = 0; request_nbr != 10; request_nbr++) {
        zmq::message_t request (6);
        memcpy ((void *) request.data (), "Hello", 5);
        std::cout << "Sending Hello " << request_nbr << "…" << std::endl;
        socket.send (request);

        // Get the reply.
        zmq::message_t reply;
        socket.recv (&reply);
        std::cout << "Received World " << request_nbr << std::endl;
    }
    return (EXIT_SUCCESS);
}

*/
